# Teaser++ Pipeline

The Teaser++ pipeline is in the `/proj` folder. The teaserpp_python is already complied from the Teaser++ Github repo and is used in the `align_teaser.py`. The `align_teaser.py` provide core functions of our Teaser++ pipeline. The `sim3estimation.py` calls functions in the `align_teaser.py` to calculate the Sim(3) parameters (s, R, T).

In order to run the Teaser++ pipeline, you can simply download the `/proj` folder and run `sim3estimation.py`. `/test_data` contains hw4's data for a demo test.

---

## Depth Models Instructions
pip install numpy opencv-python torch torchvision tqdm pillow matplotlib

```
pip install timm
pip install diffusers transformers accelerate
pip install xformers  # CUDA only

#Depth Pro
git clone https://github.com/apple/ml-depth-pro
cd ml-depth-pro
pip install -e .
source get_pretrained_models.sh

```
(did not include depth anything v2 since already have)

**note that depthpro and marigold outputs invese depth for depthpro do 1/depth and for marigold do 1-depth**

### For inferene

```
python depth_generation_all.py --depth_anything_v2
python depth_generation_all.py --midas
python depth_generation_all.py --midas_small
python depth_generation_all.py --marigold
python depth_generation_all.py --depth_pro
```
---

## ðŸš€ BUGS
In the `sim3estimation.py`, there are several comments about WRONG implementations such as the wrong reverse process and the integer depth. NOT FIXED YET.
- Bug1: The two extreme points 0 and 255 are reversed. But the current code simply use `255-PixelValue` to reverse it back which is not corresponding to the Relative-version DepthAnythingV2. NOT FIXED YET.
- Bug2: The vanilla-depth-image in the `/test_data` folder is generated by the Relative-version of DepthAnythingV2. The model's output is actually a float array, but by saving it as an depth image the float points becomes to integer pixel values, which is WRONG. NOT FIXED YET.

---

## ðŸ“‚ TODO List
- Step1: Test the Metric-version of DepthAnythingV2, to see if we can use the float result generated by this model. The current conclusion is that the metric depth are not useful for our racing car imgs.
- Step2: If the Metric-version of DepthAnythingV2 can be used, use it to generate float depth and fix `Bug2`. Otherwise continue to use the Relative-version of DepthAnythingV2 but remember to use the original float depth result instead of saving it as an integer depth image.
- Step3: If we choose to use Relative-version DepthAnythingV2 in `Step2`, we need to understand the reverse process of this model and fix `Bug1`. If we successfully run the Metric-version DepthAnythingV2 then `Bug1` should be automatically fixed as this model generates real metric depth.
